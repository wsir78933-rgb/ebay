# ðŸ” WSL2ç½‘ç»œé—®é¢˜å®Œæ•´è¯Šæ–­æŠ¥å‘Š

**è¯Šæ–­æ—¶é—´**: 2025-10-04
**é—®é¢˜**: WSL2æ— æ³•è®¿é—®GitHubç­‰å¤–ç½‘æœåŠ¡
**è¯Šæ–­äºº**: Claude Code

---

## ðŸŽ¯ æ ¹æœ¬åŽŸå› åˆ†æž

### âœ… ç¡®è®¤çš„äº‹å®ž

1. **Windowsä¸»æœºå¯ä»¥æ­£å¸¸è®¿é—®GitHub**
   - æµ‹è¯•ç»“æžœ: `TcpTestSucceeded: True`
   - é€šè¿‡æŽ¥å£: `LetsTAP` (TAPè™šæ‹Ÿç½‘å¡)
   - å®žé™…ä½¿ç”¨: Clash Verge ä»£ç†è½¯ä»¶

2. **WSL2å†…éƒ¨ç½‘ç»œé…ç½®æ­£å¸¸**
   - IPåœ°å€: `172.20.116.48/20`
   - ç½‘å…³: `172.20.112.1` âœ… å¯pingé€š
   - DNS: 223.5.5.5, 114.114.114.114, 8.8.8.8 âœ… é…ç½®æ­£ç¡®
   - MTU: 1500 âœ… æ ‡å‡†å€¼

3. **WSL2æ— æ³•è®¿é—®ä»»ä½•å¤–ç½‘**
   - Google DNS (8.8.8.8): 100% ä¸¢åŒ…
   - ç™¾åº¦: è¿žæŽ¥è¶…æ—¶
   - GitHub HTTPS: SSL handshakeè¶…æ—¶

### âŒ é—®é¢˜æ ¹æº

**Clash Vergeä»£ç†è½¯ä»¶æœªå¯¹WSL2å¼€æ”¾**

è¯æ®:
- Windowsè¿›ç¨‹: `clash-verge-service (PID 5100)` âœ… è¿è¡Œä¸­
- Clashç›‘å¬ç«¯å£: **æœªå¯¹WSL2ç½‘å…³å¼€æ”¾** âŒ
- æµ‹è¯•ç«¯å£7890/7891/1080: **å…¨éƒ¨æ‹’ç»è¿žæŽ¥** âŒ

---

## ðŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: é…ç½®Clashå…è®¸å±€åŸŸç½‘è¿žæŽ¥ (æŽ¨è)

**æ­¥éª¤**:

1. æ‰“å¼€ Clash Verge
2. è¿›å…¥ **è®¾ç½®** â†’ **ç³»ç»Ÿè®¾ç½®**
3. æ‰¾åˆ° **å…è®¸æ¥è‡ªå±€åŸŸç½‘çš„è¿žæŽ¥** (Allow LAN)
4. **å¼€å¯æ­¤é€‰é¡¹**
5. è®°å½•ä»£ç†ç«¯å£ (é€šå¸¸æ˜¯ 7890)
6. åœ¨WSL2ä¸­é…ç½®ä»£ç†:

```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc
export WINDOWS_HOST=$(ip route show | grep -i default | awk '{ print $3}')
export http_proxy="http://$WINDOWS_HOST:7890"
export https_proxy="http://$WINDOWS_HOST:7890"
export all_proxy="socks5://$WINDOWS_HOST:7891"

# Gitä¸“ç”¨é…ç½®
git config --global http.proxy "http://$WINDOWS_HOST:7890"
git config --global https.proxy "http://$WINDOWS_HOST:7890"
```

7. é‡æ–°åŠ è½½é…ç½®:
```bash
source ~/.bashrc
```

8. æµ‹è¯•è¿žæŽ¥:
```bash
curl -I https://github.com
```

---

### æ–¹æ¡ˆ2: é…ç½®WSL2é•œåƒç½‘ç»œæ¨¡å¼ (Windows 11 22H2+)

**æ­¥éª¤**:

1. åœ¨Windowsç”¨æˆ·ç›®å½•åˆ›å»º `.wslconfig` æ–‡ä»¶
   - è·¯å¾„: `C:\Users\ä½ çš„ç”¨æˆ·å\.wslconfig`

2. æ·»åŠ ä»¥ä¸‹å†…å®¹:
```ini
[wsl2]
networkingMode=mirrored
dnsTunneling=true
firewall=true
autoProxy=true
```

3. å®Œå…¨å…³é—­WSL2:
```powershell
wsl --shutdown
```

4. é‡æ–°å¯åŠ¨WSL2

**ä¼˜ç‚¹**:
- WSL2ç›´æŽ¥å…±äº«Windowsç½‘ç»œæ ˆ
- è‡ªåŠ¨ç»§æ‰¿Windowsä»£ç†è®¾ç½®
- æ— éœ€æ‰‹åŠ¨é…ç½®ä»£ç†

**è¦æ±‚**:
- Windows 11 22H2 æˆ–æ›´é«˜ç‰ˆæœ¬
- WSL 2.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬

---

### æ–¹æ¡ˆ3: ä½¿ç”¨æ‰‹æœºçƒ­ç‚¹ (ä¸´æ—¶æ–¹æ¡ˆ)

å½“éœ€è¦ç´§æ€¥æŽ¨é€ä»£ç æ—¶:

1. æ‰‹æœºå¼€å¯çƒ­ç‚¹
2. ç”µè„‘è¿žæŽ¥æ‰‹æœºçƒ­ç‚¹
3. åœ¨WSL2ä¸­æ‰§è¡Œ:
```bash
./PUSH_FIX.sh
# é€‰æ‹©é€‰é¡¹ 1 æˆ– 2
```

---

### æ–¹æ¡ˆ4: ç›´æŽ¥åœ¨Windowsä¸­æ“ä½œGit (ç»•è¿‡æ–¹æ¡ˆ)

```powershell
# åœ¨Windows PowerShellä¸­æ‰§è¡Œ
cd "\\wsl.localhost\Ubuntu\home\wcp\é¡¹ç›®é›†åˆ\ç”µå•†\src\ebay_webhook"
git push origin main
```

**æ³¨æ„**: éœ€è¦åœ¨Windowsä¸­é…ç½®Gitå‡­è¯

---

## ðŸ“Š æŠ€æœ¯ç»†èŠ‚

### ç½‘ç»œæ‹“æ‰‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Windows ä¸»æœº                    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  WLAN        â”‚    â”‚  LetsTAP     â”‚ â”‚
â”‚  â”‚  (å®žé™…ç½‘ç»œ)  â”‚    â”‚  (VPNè™šæ‹Ÿå¡) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â–²                    â–²         â”‚
â”‚         â”‚                    â”‚         â”‚
â”‚         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚         â”‚            â”‚ Clash Verge   â”‚ â”‚
â”‚         â”‚            â”‚ (ä»£ç†è½¯ä»¶)     â”‚ â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  vEthernet (WSL)                â”‚  â”‚
â”‚  â”‚  172.20.112.1 (ç½‘å…³)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   WSL2 Ubuntu         â”‚
    â”‚   172.20.116.48       â”‚
    â”‚                       â”‚
    â”‚   âŒ æ— æ³•ç›´æŽ¥è®¿é—®å¤–ç½‘ â”‚
    â”‚   âœ… å¯ä»¥è®¿é—®ç½‘å…³     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é—®é¢˜æµç¨‹

1. WSL2å‘èµ·HTTPSè¯·æ±‚ â†’ GitHub (199.59.149.235:443)
2. TCPè¿žæŽ¥æˆåŠŸ âœ…
3. TLSæ¡æ‰‹å¼€å§‹...
4. **SSL connection timeout** âŒ (5ç§’è¶…æ—¶)

**åŽŸå› **:
- WSL2çš„æµé‡æ²¡æœ‰ç»è¿‡Clashä»£ç†
- Clashåªä»£ç†Windowsä¸»æœºæµé‡
- WSL2ç›´è¿žGitHubè¢«GFWé˜»æ–­

---

## âœ… éªŒè¯æ¸…å•

é…ç½®ä»£ç†åŽ,éªŒè¯ä»¥ä¸‹å„é¡¹:

```bash
# 1. æ£€æŸ¥ä»£ç†çŽ¯å¢ƒå˜é‡
env | grep -i proxy

# 2. æµ‹è¯•GitHub HTTPS
curl -I https://github.com

# 3. æµ‹è¯•Git SSH
ssh -T git@github.com

# 4. æµ‹è¯•GitæŽ¨é€
git push origin main

# 5. æµ‹è¯•npm/pipç­‰åŒ…ç®¡ç†å™¨
curl -I https://registry.npmjs.org
```

æ‰€æœ‰æµ‹è¯•åº”è¯¥è¿”å›ž HTTP 200 æˆ–æˆåŠŸå“åº”ã€‚

---

## ðŸš€ å¿«é€Ÿä¿®å¤å‘½ä»¤

```bash
# ä¸€é”®é…ç½®Clashä»£ç† (å‡è®¾ç«¯å£7890)
cat >> ~/.bashrc << 'EOF'

# Clashä»£ç†é…ç½®
export WINDOWS_HOST=$(ip route show | grep -i default | awk '{ print $3}')
export http_proxy="http://$WINDOWS_HOST:7890"
export https_proxy="http://$WINDOWS_HOST:7890"
git config --global http.proxy "http://$WINDOWS_HOST:7890"
git config --global https.proxy "http://$WINDOWS_HOST:7890"
EOF

source ~/.bashrc

# æµ‹è¯•è¿žæŽ¥
curl -I https://github.com
```

---

## ðŸ“ ç›¸å…³æ–‡æ¡£

- Clash Vergeå®˜æ–¹æ–‡æ¡£: https://github.com/zzzgydi/clash-verge
- WSL2ç½‘ç»œé…ç½®: https://learn.microsoft.com/zh-cn/windows/wsl/networking
- WSL2é•œåƒç½‘ç»œ: https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config#wslconfig

---

**è¯Šæ–­ç»“è®º**:
âœ… WSL2æœ¬èº«ç½‘ç»œé…ç½®æ­£å¸¸
âœ… Windowsä¸»æœºå¯ä»¥è®¿é—®å¤–ç½‘
âŒ **Clashä»£ç†æœªå¯¹WSL2å¼€æ”¾** â† æ ¹æœ¬åŽŸå› 

**å»ºè®®æ“ä½œ**: é…ç½®Clashå…è®¸å±€åŸŸç½‘è¿žæŽ¥(æ–¹æ¡ˆ1) æˆ– ä½¿ç”¨WSL2é•œåƒç½‘ç»œ(æ–¹æ¡ˆ2)
